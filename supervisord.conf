[supervisord]
nodaemon=true
logfile=/tmp/supervisord.log
pidfile=/tmp/supervisord.pid

[program:backend]
command=uvicorn app.main:app --host 0.0.0.0 --port %(ENV_BACKEND_PORT)s --workers 2
directory=/app/backend
autostart=true
autorestart=true
stderr_logfile=/tmp/backend.err.log
stdout_logfile=/tmp/backend.out.log
priority=100

[program:celery-worker]
command=celery -A app.celery_app worker --loglevel=info --concurrency=2
directory=/app/backend
autostart=true
autorestart=true
stderr_logfile=/tmp/celery-worker.err.log
stdout_logfile=/tmp/celery-worker.out.log
priority=200

[program:celery-beat]
command=celery -A app.celery_app beat --loglevel=info
directory=/app/backend
autostart=true
autorestart=true
stderr_logfile=/tmp/celery-beat.err.log
stdout_logfile=/tmp/celery-beat.out.log
priority=300

[program:nginx]
command=/usr/sbin/nginx -g 'daemon off;'
autostart=true
autorestart=true
stderr_logfile=/tmp/nginx.err.log
stdout_logfile=/tmp/nginx.out.log
priority=400
user=www-data